<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dogs and Cats</title>

     <!-- Include jQuery library  -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

     <!-- Include Tailwind library  -->
    <script src="https://cdn.tailwindcss.com"></script>

     <!-- Include Flowbite CSS  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet" />

    

</head>
<body onload="fetchDogImage(), fetchCatImage()" class="bg-cover bg-center" style="background-image: url('https://images.pexels.com/photos/952670/pexels-photo-952670.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1')">

<div class="p-20 mx-auto max-w-sm space-x-4 bg-slate-50 rounded-xl">

    <div class="bg-white rounded-lg shadow-2xl ">

        <img class="rounded-t-lg" id="dogImage"></img>

        <div class="p-6">

            <!-- Icon -->
            <div class="shrink-0">

                <img class="h-12 w-12" src="https://img.icons8.com/bubbles/256/dog.png" alt="dog icon">

            </div>

            <!-- Fetch button -->
            <div class="text-xl font-medium text-black">

                <button id="fetchDogBtn" onclick="fetchDogImage()" class="text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-medium rounded-lg text-lg px-5 py-2.5 text-center mr-2 mb-2" >Fetch new dogs</button>

            </div>

            <!-- Classify button -->
            <div class="text-xl font-medium text-black">

                <button id="show-div" >AI classify</button>

            </div>

        </div>
    
    </div>
    
</div>



<!-- Hidden Classify Div -->
<div id="hidden" style="display: none;" class="p-6 max-w-xs mx-auto bg-white rounded-xl shadow-lg flex items-center space-x-4 " >

    <!-- Dog Label -->
    <span class="text-xl font-medium text-black" id="dogLabel"></span>

</div>


</div>

<!-- Cat Element -->
<div class="p-20 mx-auto max-w-sm space-x-4 bg-slate-50 rounded-xl">
    
    <div class="bg-white rounded-lg shadow-2xl ">

        <img class="rounded-t-lg" id="catImage"/>

      <div class="p-6">

        <!-- Icon -->
        <a class="shrink-0">

            <img class="h-12 w-12" src="https://img.icons8.com/?size=512&id=tgLepcPbp6mP&format=png" alt="dog icon">

        </a>

        <!-- Fetch button -->
        <div class="text-xl font-medium text-black">

            <button id="fetchCatBtn" onclick="fetchCatImage()" class="text-white bg-gradient-to-r from-pink-400 via-pink-500 to-pink-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-pink-300 dark:focus:ring-pink-800 font-medium rounded-lg text-lg px-5 py-2.5 text-center mr-2 mb-2">Fetch new cats</button>

        </div>

        <!-- Classify button -->
        <div class="text-xl font-medium text-black">

            <button id="show-div-cat" class="text-white bg-gradient-to-r from-red-400 via-red-500 to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-lg px-5 py-2.5 text-center mr-2 mb-2" >AI classify</button>

        </div>

      </div>
  
    </div>

  </div>


<!-- Hidden Classify Div -->
<div id="hidden-cat" style="display: none;" class="p-6 max-w-xs mx-auto bg-white rounded-xl shadow-lg flex items-center space-x-4 " >

    <!-- cat Label -->
    <span class="text-xl font-medium text-black" id="catLabel"></span>

</div>

<!-- Upload Image -->
<div class="p-6 max-w-xs mx-auto bg-white rounded-xl shadow-lg flex items-center ">

    <form method="POST" action="{% url 'page:upload_image' %}" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.image }}
        <div id="wrapper" class="space-y-5">

            <div>
                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="file_input">Upload file</label>

                <input type="file" name="image" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-slate-50 " id="file_input" >

            </div>

            <div>

                <button type="submit" id="hide-superposition" class="text-white bg-gradient-to-br from-pink-500 to-orange-400 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-pink-200 dark:focus:ring-pink-800 font-medium rounded-lg text-xl px-5 py-2.5 text-center mr-2 mb-2 ">Submit</button>

            </div>

        </div>
    </form>

</div>



<!--  SuperpositionImage element  -->
<div  class="max-w-sm mx-auto bg-white border border-gray-200 rounded-xl shadow ">
    
    <img id="superpositionImage" class="rounded-t-lg max-w-sm mx-auto" src="" alt="Upload an image and press Submit">

    <!-- padding, max width, center, bg, rounder corners, shadow, flex, center items, padding between child elements  -->
    <div class="p-6 max-w-sm mx-auto bg-white rounded-xl shadow-lg flex items-center space-x-4">

        <!-- Icon -->
        <div class="shrink-0">

            <img class="h-12 w-12" src="https://img.icons8.com/?size=512&id=111409&format=png" alt="dog icon">

        </div>


        <!-- Classify button -->
        <div class="text-xl font-medium text-black">

            <button type="submit" id="show-div-superposition" onclick="classifyUploadedImage()">AI classify</button>

        </div>

    </div>

</div>

<!-- Display image -->
<script>
    const form = document.querySelector('form');
    const imgElement = document.getElementById('superpositionImage');

    form.addEventListener('submit', (event) => {
    event.preventDefault(); // prevent the form from submitting and refreshing the page
    
    const formData = new FormData(form); // create a FormData object from the form
    const file = formData.get('image'); // get the uploaded file from the FormData object

    const reader = new FileReader(); // create a FileReader object to read the file
    reader.readAsDataURL(file); // read the file as a data URL

    reader.onload = () => {
        imgElement.src = reader.result; // set the src attribute of the img element with the data URL
    };
    });
</script>

<!-- Hidden Classify Div -->
<div id="hidden-superposition" style="display: none;" class="p-6 max-w-xs mx-auto bg-white rounded-xl shadow-lg flex items-center space-x-4 " >

    <!-- superposition Label -->
    <span class="text-xl font-medium text-black" id="superpositionLabel"></span>

</div>

<!-- Labels -->
<script>
    const showDogDiv = document.getElementById("show-div");
    const hiddennDogDiv = document.getElementById("hidden");

    showDogDiv.addEventListener("click", function() {
    hiddennDogDiv.style.display = "block";
});

</script>

<script>
    const showcatDivButton = document.getElementById("show-div-cat");
    const hiddencatDiv = document.getElementById("hidden-cat");

    showcatDivButton.addEventListener("click", function() {
        hiddencatDiv.style.display = "block";
});

</script>

<script>
    const hideSuperpositionLabel = document.getElementById("hide-superposition");
    const hiddenSuperpositionDiv = document.getElementById("hidden-superposition");

    hideSuperpositionLabel.addEventListener("click", function() {
        hiddenSuperpositionDiv.style.display = "none";
});
</script>

<script>
    const showSuperpositionLabel = document.getElementById("show-div-superposition");

    showSuperpositionLabel.addEventListener("click", function() {
        hiddenSuperpositionDiv.style.display = "block";
});

</script>


<script>

function fetchDogImage() {
    $.get('/get_dog/', function(data) {
        var message = data['message'];
        var label = data['label'];
        $('#dogImage').attr('src', message);
        $('#dogLabel').text('The AI has classified this as a ' + label);
        hiddennDogDiv.style.display = "none";
    })
    .fail(function() {
        console.log('Failed to fetch dog image.');
    });
}

function fetchCatImage() {
    $.get('/get_cat/', function(data) {
        var url = data['url'];
        var label = data['label'];
        $('#catImage').attr('src', url);
        $('#catLabel').text('The AI has classified this as a ' + label);
        hiddencatDiv.style.display = "none";
    })
    .fail(function() {
        console.log('Failed to fetch cat image.');
    });
}

function classifyUploadedImage() {
    // Get the CSRF token from the cookie
    var csrftoken = getCookie('csrftoken');

    // Get the image file from the form
    var imageFile = $('input[name="image"]').prop('files')[0];

    // Create a FormData object to send the file to the server
    var formData = new FormData();
    formData.append('image', imageFile);
    formData.append('csrfmiddlewaretoken', csrftoken);

    // Send a POST request to the server
    $.ajax({
        url: '/upload_image/',
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        success: function(data) {
            var label = data['label'];
            $('#superpositionLabel').text('The AI has classified this as a ' + label);
        },
        error: function() {
            console.log('Failed to fetch image.');
        }
    });
}

// Function to get the CSRF token from the cookie
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>

</body>
</html>
